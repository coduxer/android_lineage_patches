From d54e94a6ec5b720e25f91808bda2ec27f125ccd2 Mon Sep 17 00:00:00 2001
From: Rishawn <70256146+Stealth1226@users.noreply.github.com>
Date: Mon, 10 Jan 2022 09:47:15 +0530
Subject: [PATCH] base: Allow disabling ripple effect on unlock [1/2]

neobuddy89:
* Reverse logic. Enabled animation by default.

ArrowOS:
* Add keys into backup and validators.

Change-Id: Idecaa59547159d0a2b0ecdb55a207377bd466710
---
 core/java/android/provider/Settings.java                 | 6 ++++++
 .../android/provider/settings/backup/SystemSettings.java | 1 +
 .../settings/validators/SystemSettingsValidators.java    | 1 +
 .../com/android/systemui/biometrics/AuthRippleView.kt    | 9 ++++++++-
 4 files changed, 16 insertions(+), 1 deletion(-)

diff --git a/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleView.kt b/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleView.kt
index 378ae14f0327..437d269bf254 100644
--- a/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleView.kt
+++ b/packages/SystemUI/src/com/android/systemui/biometrics/AuthRippleView.kt
@@ -24,6 +24,8 @@ import android.graphics.Canvas
 import android.graphics.Color
 import android.graphics.Paint
 import android.graphics.PointF
+import android.os.UserHandle
+import lineageos.providers.LineageSettings;
 import android.util.AttributeSet
 import android.view.View
 import android.view.animation.PathInterpolator
@@ -263,7 +265,12 @@ class AuthRippleView(context: Context?, attrs: AttributeSet?) : View(context, at
      * Ripple that bursts outwards from the position of the sensor to the edges of the screen
      */
     fun startUnlockedRipple(onAnimationEnd: Runnable?) {
-        if (unlockedRippleInProgress) {
+        val enableRipple = LineageSettings.System.getIntForUser(
+            context.contentResolver,
+            LineageSettings.System.ENABLE_RIPPLE_EFFECT, 1,
+            UserHandle.USER_CURRENT) == 1
+
+        if (unlockedRippleInProgress || !enableRipple) {
             return // Ignore if ripple effect is already playing
         }
 
-- 
2.39.0

